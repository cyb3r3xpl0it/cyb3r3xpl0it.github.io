---
layout: single
title: Driver Writeup HTB (OSCP Style)
excerpt: "En el siguiente artículo veremos como realizar una enumeración al momento de estar en un pentesting sobre windows"
date: 2022-05-10
classes: wide
image: /assets/img/posts/HTB/driver/driver.png
categories:
  - HTB
tags:
  - Hacking
---

![header-driver](/assets/img/posts/HTB/driver/driver.png)

## Datos de la Máquina                                                                                                                                         
                                                                                                                                                                   
| Contenido | Descripción |                                                                                                                                        
|--|--|                                                                                                                                                            
| OS: | ![windows](/assets/img/posts/windows.png) |                                                                                                                                         
| Dificultad: | Fácil |                                                                                                                                            
| Puntos: | 20 |                                                                                                                                                   
| Lanzamiento: | 02 Oct 2021 |                                                                                                                                
| Creadores: |[MrR3boot](https://app.hackthebox.com/users/13531) |

## Reconocimiento
### nmap

Como siempre comenzaremos con un escaneo a los '65535' puertos TCP/IP para verificar cuales se encuentran abiertos, para esto ejecutaremos el siguiente comando:
```console
nmap -n -p- -T4 --min-rate 10000 10.129.132.243 --open -oA alltcp
```
Como observamos en la siguiente imagen encontramos con los siguientes puertos abiertos:
- 80 (http)
- 135 (msrpc)
- 445 (microsoft-ds)
- 5985 (wsman)

![nmap-tcp](/assets/img/posts/HTB/driver/nmap-tcp.jpg)

Una vez identificados los puertos abiertos, procederemos a identificar las versiones y servicios de estos:

```console
nmap -sCV -n -p 80,135,445,5985 -T4 10.129.132.243 -oA tcp-scripts
```
![nmap-tcp-scripts](/assets/img/posts/HTB/driver/nmap-tcp-scripts.jpg)

Basandonos en las version del IIS que se encontro, podemos deducir que el host esta corriendo un Windows 10 o un Windows Server 2016. Observando la salida del script nos arrojó lo siguiente 'Basic realm=MFP Firmware Update Center, Please enter password for admin'.  
  
Y como observamos en el escaneo de puertos teniamos el puerto '5985 abierto WINRM', si lograramos obtener las credeciales tendriamos un vector de ataque.

### SMB - 445/TCP

Tratamos de conectarnos por medio de **smbmap** y **smbclient** sin credenciales lo cual no tenemos exitó.

![SMB-enumeration](/assets/img/posts/HTB/driver/smb-enum.jpg)

### HTTP - 80/TCP

#### Authenticación
Visitmos la web y nos arroja un login.

![Web-enumeration](/assets/img/posts/HTB/driver/web.jpg)

Procedemos a interceptar este login con burp para observar si nos puede arrojar algo de valor, lo cual no observamos nada importante.

![web-burp](/assets/img/posts/HTB/driver/web-burp.jpg)

Pero al recordar el la fase de reconocimiento el script de nmap nos arrojo que necesitabamos el password de admin por lo cual ya contamos con el usuario, lo cual tratamos con admin:admin y tenemos exitó al iniciar sesion.

#### Sitio

El sitio es el MFP Fireware Update Center:

![web-login](/assets/img/posts/HTB/driver/web-login.jpg)

Al navegar sobre la web nos percatamos que unicamente sirve un link lo cual nos manda hacia **fw_up.php**, lo cual es una actualización de firmware.

![web-firmware](/assets/img/posts/HTB/driver/web-firmware.jpg)

Tratamos de subir un archivo e interceptaremos la solicitud con burpsuite, y observamos que la solicitud lo manda a traves del metodo POSTs

![burp-img](/assets/img/posts/HTB/driver/burp-img.jpg)

Observando la web princial es **index.php**, lo cual mandamos una solicitud y obtenemos como respuesta la versión de IIS así como la versión de PHP.

![burp-img](/assets/img/posts/HTB/driver/response-index.jpg)

#### Busqueda de Directorios

Una vez esto usaremos gobuster para buscar archivos y directorios existentes, como sabemos el sistema esta creado con php, por lo cual indicaremos la extensión.  
  
Pero como observamos en la siguiente imagen no obtuvimos exitó.

```console
gobuster dir -u http://driver.htb -e -x php -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-small-words-lowercase.txt
```
![gobuster](/assets/img/posts/HTB/driver/gobuster.jpg)


